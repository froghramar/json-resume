{% macro format_duration(start, end) %}
    {% if start and end %}
        {% set start_year = start.split('-')[0] | int %}
        {% set start_month = start.split('-')[1] | int %}
        {% set end_year = end.split('-')[0] | int %}
        {% set end_month = end.split('-')[1] | int %}
        {% set total_months = (end_year - start_year) * 12 + (end_month - start_month) + 1 %}
        {% set years = (total_months // 12) %}
        {% set months = (total_months % 12) %}
        &nbsp;‚Ä¢&nbsp;{% if years > 0 %}{{ years }} year{% if years != 1 %}s{% endif %}{% endif %}{% if months > 0 %}{% if years > 0 %} {% endif %}{{ months }} month{% if months > 1 %}s{% endif %}{% endif %}
    {% endif %}
{% endmacro %}
{% macro format_date(date_str) %}
    {% set months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'] %}
    {% if date_str %}
        {% set year = date_str.split('-')[0] %}
        {% set month = date_str.split('-')[1] | int %}
        {{ months[month-1] }} {{ year }}
    {% endif %}
{% endmacro %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ name }} - Resume</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,500" rel="stylesheet">
    <style>
        @page {
            @bottom-center {
                content: "Page " counter(page) " of " counter(pages);
                font-family: 'Roboto', Arial, sans-serif;
                font-size: 0.75em;
                color: #888;
            }
            margin-bottom: 28px;
            margin-top: 25px;
        }
        .exp-role-timeline {
            display: flex;
            align-items: flex-start;
        }
        .exp-role-timeline-marker {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 10px;
            position: relative;
            min-width: 6px;
        }
        .exp-role-circle {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #2a7ae2;
            border: 1px solid #fff;
            box-shadow: 0 0 0 1px #2a7ae2;
            z-index: 1;
            margin-top: 3px;
        }
        .exp-role-line {
            width: 2px;
            flex: 1 1 auto;
            background: #2a7ae2;
            margin-top: 0;
            margin-bottom: 0;
        }
        .exp-role-promotion {
            border-left: 2px solid #2a7ae2;
            padding-left: 10px;
            margin-left: 4px;
            background: #f6faff;
        }
        .exp-role-content-bordered {
            border-left: 2px solid #2a7ae2;
            padding-bottom: 12px;
            margin-bottom: 8px;
        }
        body {
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #f0f4f8 100%);
            color: #2c3e50;
            line-height: 1.3;
            font-size: 0.9em;
        }
        .container {
            max-width: 800px;
            margin: 10px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06), 0 2px 8px rgba(0,0,0,0.04);
            padding: 16px 20px;
            border: 1px solid rgba(0,0,0,0.03);
        }
        h1 {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1.6em;
            margin-bottom: 3px;
            color: #1a5490;
            letter-spacing: 0px;
            font-weight: 700;
            line-height: 1.1;
        }
        h2 {
            margin-top: 1.2em;
            margin-bottom: 0.3em;
            color: #1a5490;
            font-size: 1.05em;
            font-family: 'Montserrat', Arial, sans-serif;
            display: flex;
            align-items: center;
            padding-bottom: 2px;
            border-bottom: 2px solid #e8f1f8;
            font-weight: 600;
        }
        h2 .icon {
            margin-right: 6px;
            font-size: 1.1em;
        }
        .section {
            margin-bottom: 0.5em;
        }
        .headline {
            color: #546e7a;
            font-size: 0.88em;
            line-height: 1.3;
            margin-bottom: 0.3em;
            font-weight: 400;
        }
        .label {
            font-weight: bold;
            color: #2a7ae2;
        }
        ul {
            margin: 0;
            padding-left: 0.9em;
        }
        .profile-contact-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 8px;
        }
        .profile-col {
            flex: 1 1 220px;
            min-width: 180px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .contact-col {
            flex: 2 1 320px;
            min-width: 220px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 6px;
        }
        .contact-item {
            display: flex;
            align-items: center;
            font-size: 0.95em;
            color: #444;
        }
        .contact-item .icon {
            margin-right: 6px;
            color: #2a7ae2;
            font-size: 1.05em;
        }
        .profile-pic {
            width: 110px;
            height: 110px;
            border-radius: 12px;
            object-fit: cover;
            margin-bottom: 8px;
            border: 2px solid #2a7ae2;
            box-shadow: 0 2px 8px rgba(42,122,226,0.15);
            display: block;
        }
        .exp-card {
            border-radius: 6px;
            padding: 6px;
            margin-bottom: 6px;
        }
        .exp-title {
            font-size: 1em;
            font-weight: bold;
            color: #2a7ae2;
        }
        .exp-company {
            color: #555;
            font-weight: 500;
            font-size: 0.92em;
        }
        .exp-location {
            color: #888;
            font-size: 0.88em;
        }
        .exp-dates {
            color: #888;
            font-size: 0.88em;
        }
        .exp-skills {
            margin-top: 8px;
            color: #555; /* neutral dark grey for skills text */
        }
        .exp-skills .label {
            color: #444; /* darker label color within skills */
            font-weight: 600;
            margin-right: 6px;
        }
        .skill-pill {
            display: inline-block;
            background: #f3f4f6; /* light grey */
            color: #555; /* dark grey text */
            border: 1px solid #e6e7e9; /* subtle grey border */
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.82em;
            margin-right: 3px;
            margin-bottom: 3px;
        }
        .skills-list { margin-top: 2px; }
        .exp-highlights {
            margin-top: 2px;
        }
        .exp-highlights li {
            margin-bottom: 0px;
            line-height: 1.3;
        }
        .cert-list, .vol-list {
            margin-top: 6px;
        }
        .cert-list li, .vol-list li {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        a {
            color: #2a7ae2;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
</body>
<div class="container">
    <div class="profile-contact-row">
        <div class="profile-col">
            {% if profile_picture %}
            <img src="{{ profile_picture }}" alt="Profile Picture" class="profile-pic">
            {% endif %}
        </div>
        <div class="contact-col">
            <div class="contact-info">
                <div class="contact-item"><span class="icon" style="display:flex;align-items:center;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2a7ae2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;display:block;"><rect x="3" y="5" width="18" height="14" rx="2"/><polyline points="3 7 12 13 21 7"/></svg></span><a href="mailto:{{ contact.email }}">{{ contact.email }}</a></div>
                <div class="contact-item"><span class="icon" style="display:flex;align-items:center;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2a7ae2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;display:block;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.86 19.86 0 0 1 3.08 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.13.81.36 1.6.68 2.34a2 2 0 0 1-.45 2.11l-1.27 1.27a16 16 0 0 0 6.29 6.29l1.27-1.27a2 2 0 0 1 2.11-.45c.74.32 1.53.55 2.34.68A2 2 0 0 1 22 16.92z"/></svg></span><a href="tel:{{ contact.phone }}">{{ contact.phone }}</a></div>
                {% if contact.phone_secondary %}
                <div class="contact-item"><span class="icon" style="display:flex;align-items:center;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2a7ae2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;display:block;"><path d="M22 16.92v3a2 2 0 0 1-2.18 2A19.86 19.86 0 0 1 3.08 5.18 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.72c.13.81.36 1.6.68 2.34a2 2 0 0 1-.45 2.11l-1.27 1.27a16 16 0 0 0 6.29 6.29l1.27-1.27a2 2 0 0 1 2.11-.45c.74.32 1.53.55 2.34.68A2 2 0 0 1 22 16.92z"/></svg></span><a href="tel:{{ contact.phone_secondary }}">{{ contact.phone_secondary }}</a></div>
                {% endif %}
                <div class="contact-item"><span class="icon" style="display:flex;align-items:center;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#2a7ae2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;display:block;"><path d="M21 10.2C21 16.2 12 22 12 22S3 16.2 3 10.2a9 9 0 1 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg></span>{{ contact.address }}</div>
                {% if contact.linkedin %}
                <div class="contact-item">
                    <span class="icon"><img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/linkedin.svg" alt="LinkedIn" style="width:18px;height:18px;vertical-align:middle;filter:grayscale(0);"></span>
                    <a href="{{ contact.linkedin }}" target="_blank" rel="noopener noreferrer">{{ contact.linkedin }}</a>
                </div>
                {% endif %}
                {% if education and education[0] %}
                <div class="contact-item">
                    {% if education[0].logo %}
                    <span class="icon"><img src="{{ education[0].logo }}" alt="{{ education[0].institution }} logo" style="width:20px;height:20px;border-radius:4px;object-fit:contain;background:#fff;border:1px solid #e3eaf3;vertical-align:middle;"></span>
                    {% endif %}
                    {% if education[0].website %}
                    <a href="{{ education[0].website }}" target="_blank">{{ education[0].institution }}</a>
                    {% else %}
                    {{ education[0].institution }}
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    <h1>{{ name }}</h1>
    {% if summary %}
    <div>{{ summary }}</div>
    {% endif %}
    <div class="section">
        <h2><span class="icon">üíº</span>Experience</h2>
        {% for exp in experience %}
        {% if exp.roles %}
        <div class="exp-card" style="padding-left:0;">
            <div style="display:flex; align-items:center; gap:12px;">
                {% if exp.company_image %}
                <img src="{{ exp.company_image }}" alt="{{ exp.company }} logo" style="width:32px;height:32px;border-radius:6px;object-fit:contain;background:#fff;border:1px solid #e3eaf3;box-shadow:0 1px 4px rgba(42,122,226,0.08);">
                {% endif %}
                <div style="display:flex; flex-direction:column;">
                    <span class="exp-company" style="font-size:1.1em;font-weight:bold;">
                        {% if exp.company_website %}
                        <a href="{{ exp.company_website }}" target="_blank">{{ exp.company }}</a>
                        {% else %}
                        {{ exp.company }}
                        {% endif %}
                    </span>
                    {% if exp.employment_type or (exp.roles and exp.roles|length > 1) %}
                    <span style="color:#888; font-size:0.95em; margin-top:2px;">
                        {% if exp.employment_type %}{{ exp.employment_type }}{% endif %}
                        {{ format_duration(exp.roles[-1].start, exp.roles[0].end) }}
                    </span>
                    {% endif %}
                </div>
            </div>
            <div style="margin-top:10px; margin-left:12px;">
                {% for role in exp.roles %}
                <div style="display:flex; align-items:flex-start;">
                    <div class="exp-role-timeline" style="margin-right:0; align-items:center;">
                        <div class="exp-role-timeline-marker">
                            <div class="exp-role-circle"></div>
                            {% if not loop.last %}
                            <div class="exp-role-line"></div>
                            {% endif %}
                        </div>
                    </div>
                    <div style="flex:1;">
                        <div style="padding-left: 15px;">
                            <span class="exp-title">{{ role.title }}</span>
                        </div>
                        <div {% if not loop.last %}class="exp-role-content-bordered"{% endif %} style="padding-left: 28px; margin-left: -15px;">
                            <div style="color:#888; font-size:0.95em; margin-bottom:2px;">
                                <span class="exp-dates">
                                    {{ format_date(role.start) }} ‚Äì {{ format_date(role.end) }}{{ format_duration(role.start, role.end) }}
                                </span>
                            </div>
                            {% if role.location %}<div class="exp-location">{{ role.location }}</div>{% endif %}
                            <div style="margin-top:6px;">{{ role.description }}</div>
                            {% if role.highlights %}
                            <ul class="exp-highlights">
                                {% for h in role.highlights %}
                                <li>{{ h }}</li>
                                {% endfor %}
                            </ul>
                            {% endif %}
                            {% if role.skills %}
                            <div class="exp-skills"><span class="label">Skills:</span>
                                {% for s in role.skills %}
                                <span class="skill-pill">{{ s }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="exp-card" style="padding-left:0;">
            <div style="display:flex; gap:12px;">
                {% if exp.company_image %}
                <img src="{{ exp.company_image }}" alt="{{ exp.company }} logo" style="width:32px;margin-top:5px;height:32px;border-radius:6px;object-fit:contain;background:#fff;border:1px solid #e3eaf3;box-shadow:0 1px 4px rgba(42,122,226,0.08);">
                {% endif %}
                <div style="flex:1; display:flex; flex-direction:column;">
                    <span class="exp-title">{{ exp.title }}</span>
                    <span class="exp-company">
                        {% if exp.company_website %}
                        <a href="{{ exp.company_website }}" target="_blank">{{ exp.company }}</a>
                        {% else %}
                        {{ exp.company }}
                        {% endif %}
                        {% if exp.employment_type %}
                        <span style="color:#888; font-size:0.95em; margin-left:8px;">{{ exp.employment_type }}</span>
                        {% endif %}
                    </span>
                    <span style="color:#888; font-size:0.95em; margin-bottom:2px;">
                        {{ format_date(exp.start) }} ‚Äì {{ format_date(exp.end) }}{{ format_duration(exp.start, exp.end) }}
                    </span>
                    {% if exp.location %}
                    <span class="exp-location" style="margin-top:2px; color:#888;">{{ exp.location }}</span>
                    {% endif %}
                </div>
            </div>
            <div style="margin-top:8px; margin-left:44px;"> <!-- aligns with company name, not image -->
                <div>{{ exp.description }}</div>
                {% if exp.highlights %}
                <ul class="exp-highlights">
                    {% for h in exp.highlights %}
                    <li>{{ h }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if exp.skills %}
                <div class="exp-skills"><span class="label">Skills:</span>
                    {% for s in exp.skills %}
                    <span class="skill-pill">{{ s }}</span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    <div class="section">
        <h2><span class="icon">üéì</span>Education</h2>
        <ul>
        {% for edu in education %}
            <li style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
                {% if edu.logo %}
                <img src="{{ edu.logo }}" alt="{{ edu.institution }} logo" style="width:32px;height:32px;border-radius:6px;object-fit:contain;background:#fff;border:1px solid #e3eaf3;box-shadow:0 1px 4px rgba(42,122,226,0.08);">
                {% endif %}
                <div>
                    <span style="font-weight:bold;">{{ edu.degree }}</span> from 
                    {% if edu.website %}
                    <a href="{{ edu.website }}" target="_blank">{{ edu.institution }}</a>
                    {% else %}
                    {{ edu.institution }}
                    {% endif %}
                    ({{ edu.year }})
                </div>
            </li>
        {% endfor %}
        </ul>
    </div>
    <div class="section">
        <h2><span class="icon">üõ†Ô∏è</span>Skills</h2>
        <div class="skills-list">
            {% for s in skills %}
            <span class="skill-pill">{{ s }}</span>
            {% endfor %}
        </div>
    </div>
    {% if certifications %}
    <div class="section">
        <h2><span class="icon">üìú</span>Certifications</h2>
        <ul class="cert-list">
        {% for cert in certifications %}
            <li>
                {% if cert.link %}
                    <a href="{{ cert.link }}" target="_blank">{{ cert.name }}</a>
                {% else %}
                    {{ cert.name }}
                {% endif %}
                <span style="color:#555;"> ({{ cert.issuer }})</span>
            </li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% if volunteer %}
    <div class="section">
        <h2><span class="icon">ü§ù</span>Volunteer</h2>
        <ul class="vol-list">
        {% for v in volunteer %}
            <li><b>{{ v.role }}</b> at {{ v.organization }} ({{ v.year }})<br>{{ v.description }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>
</html>
